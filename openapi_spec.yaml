openapi: 3.0.2
info:
  title: ECE 461 - Fall 2025 - Team 26 API
  version: 2.0.0
  description: |-
    API for the Team 26 Model Registry (Phase 2).
    
    This API allows for the ingestion, retrieval, rating, and management of artifacts (models, datasets, code).
    
    **Implementation Details:**
    - Endpoints use `/artifact` and `/artifacts` paths with artifact type specification
    - Artifact types: `model`, `dataset`, `code`
    - Authentication is handled via the `X-Authorization` header
    - Async ingestion with blocking GET for autograder compatibility
  contact:
    name: Team 26
    email: team26@purdue.edu
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

paths:
  /health:
    get:
      summary: Health check
      operationId: HealthCheck
      responses:
        "200":
          description: Server is up and running.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /artifact/{artifact_type}:
    post:
      summary: Upload an artifact
      operationId: CreateArtifact
      description: Ingest a new artifact (model, dataset, or code) into the registry.
      parameters:
        - name: artifact_type
          in: path
          description: Type of artifact
          required: true
          schema:
            type: string
            enum: [model, dataset, code]
        - name: X-Authorization
          in: header
          description: Authentication token
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ArtifactCreateRequest"
        required: true
      responses:
        "200":
          description: Artifact uploaded successfully (sync mode).
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "201":
          description: Artifact uploaded successfully.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "202":
          description: Artifact upload accepted, processing asynchronously.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "400":
          description: Malformed request (missing fields, bad URL).
        "409":
          description: Artifact already exists.
        "424":
          description: Artifact disqualified due to rating.

  /artifacts:
    post:
      summary: List artifacts
      operationId: ListArtifacts
      description: Get artifacts from the registry (with optional pagination and filtering).
      parameters:
        - name: X-Authorization
          in: header
          description: Authentication token
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
        - name: offset
          in: query
          description: Pagination offset
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/ArtifactQuery"
        required: false
      responses:
        "200":
          description: List of artifacts.
          headers:
            offset:
              schema:
                type: string
                description: Offset for the next page of results.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ArtifactMetadata"
        "413":
          description: Too many artifacts returned.

  /artifacts/{artifact_type}/{id}:
    parameters:
      - name: artifact_type
        in: path
        required: true
        schema:
          type: string
          enum: [model, dataset, code]
        description: Type of artifact
      - name: id
        in: path
        required: true
        schema:
          type: integer
        description: Unique ID of the artifact.
      - name: X-Authorization
        in: header
        required: true
        schema:
          $ref: "#/components/schemas/AuthenticationToken"
    get:
      summary: Retrieve artifact
      operationId: RetrieveArtifact
      description: |
        Retrieve an artifact (metadata + download info) by ID.
        Blocks until artifact is ready (for autograder compatibility).
        Returns 404 for disqualified/failed/rejected artifacts.
      responses:
        "200":
          description: Artifact found and ready.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "404":
          description: Artifact does not exist or is disqualified.
        "504":
          description: Artifact processing timeout (exceeded 170s).
    put:
      summary: Update artifact
      operationId: UpdateArtifact
      description: Update the content or metadata of an existing artifact.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Artifact"
        required: true
      responses:
        "200":
          description: Artifact updated.
        "404":
          description: Artifact does not exist.
    delete:
      summary: Delete artifact
      operationId: DeleteArtifact
      description: Remove an artifact from the registry.
      responses:
        "200":
          description: Artifact deleted.
        "404":
          description: Artifact does not exist.

  /artifact/model/{id}/rate:
    get:
      summary: Get model rating
      operationId: RateModel
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: X-Authorization
          in: header
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
      description: |
        Get rating metrics for a model. Blocks until rating is ready (for autograder compatibility).
        Returns 404 for disqualified/failed/rejected models.
      responses:
        "200":
          description: Rating scores.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ModelRating"
        "404":
          description: Model does not exist or rating not available.
        "500":
          description: The scorer encountered an error.
        "504":
          description: Rating timeout (exceeded 170s).

  /artifact/{artifact_type}/{id}/cost:
    get:
      summary: Get artifact cost
      operationId: GetArtifactCost
      parameters:
        - name: artifact_type
          in: path
          required: true
          schema:
            type: string
            enum: [model, dataset, code]
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: dependency
          in: query
          schema:
            type: boolean
        - name: X-Authorization
          in: header
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
      responses:
        "200":
          description: Artifact cost details.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ArtifactCost"
        "404":
          description: Artifact not found.

  /artifact/byRegEx:
    post:
      summary: Search by Regex
      operationId: SearchByRegex
      description: |
        Search artifacts by regex pattern. Blocks for up to 170 seconds waiting for artifacts to become ready.
      parameters:
        - name: X-Authorization
          in: header
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                regex:
                  type: string
                  description: Regular expression pattern (case-insensitive)
              required:
                - regex
      responses:
        "200":
          description: List of artifacts matching regex.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ArtifactMetadata"
        "400":
          description: Invalid regex pattern.
        "404":
          description: No artifacts found matching pattern.

  /artifact/model/{id}/lineage:
    get:
      summary: Get model lineage
      operationId: GetModelLineage
      description: Get parent model information from config.json
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: X-Authorization
          in: header
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
      responses:
        "200":
          description: Model lineage information
          content:
            application/json:
              schema:
                type: object
                properties:
                  parent_model:
                    type: string
                    nullable: true
        "404":
          description: Model not found

  /artifact/model/{id}/license-check:
    get:
      summary: License compatibility check
      operationId: CheckLicense
      description: Check license compatibility for a model
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: X-Authorization
          in: header
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
      responses:
        "200":
          description: License information
          content:
            application/json:
              schema:
                type: object
                properties:
                  license:
                    type: string
                  compatible:
                    type: boolean
        "404":
          description: Model not found

  /activity:
    get:
      summary: Get activity logs
      operationId: GetActivityLogs
      description: Retrieve recent activity logs (uploads, downloads, searches, etc.)
      parameters:
        - name: X-Authorization
          in: header
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
      responses:
        "200":
          description: List of activity logs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ActivityLog"

  /authenticate:
    put:
      summary: Create Auth Token
      operationId: AuthenticateUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthenticationRequest"
      responses:
        "200":
          description: Authentication successful.
          content:
            application/json:
              schema:
                type: string
                description: The bearer token.
        "401":
          description: Invalid credentials.

  /reset:
    delete:
      summary: Reset Registry
      operationId: ResetRegistry
      description: Reset the registry to a system default state.
      parameters:
        - name: X-Authorization
          in: header
          required: true
          schema:
            $ref: "#/components/schemas/AuthenticationToken"
      responses:
        "200":
          description: Registry reset successfully.
        "401":
          description: Unauthorized.

  /tracks:
    get:
      summary: Get implemented tracks
      operationId: GetTracks
      responses:
        "200":
          description: List of tracks implemented by the team.
          content:
            application/json:
              schema:
                type: object
                properties:
                  plannedTracks:
                    type: array
                    items:
                      type: string

components:
  schemas:
    AuthenticationToken:
      type: string
      description: Bearer token for API access.

    AuthenticationRequest:
      type: object
      required:
        - User
        - Secret
      properties:
        User:
          type: object
          properties:
            name:
              type: string
            isAdmin:
              type: boolean
        Secret:
          type: object
          properties:
            password:
              type: string

    Artifact:
      type: object
      properties:
        metadata:
          $ref: "#/components/schemas/ArtifactMetadata"
        data:
          $ref: "#/components/schemas/ArtifactData"

    ArtifactCreateRequest:
      type: object
      required:
        - url
        - name
      properties:
        url:
          type: string
          format: uri
          description: Source URL (HuggingFace, GitHub, etc.)
        name:
          type: string
          description: Display name for the artifact
        revision:
          type: string
          description: Git revision/branch (default "main")
          default: main

    ArtifactMetadata:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        type:
          type: string
          enum: [model, dataset, code]
        version:
          type: string
        status:
          type: string
          enum: [pending, ingesting, rating_in_progress, ready, completed, disqualified, failed, rejected]
        net_score:
          type: number
          format: float
          nullable: true

    ArtifactData:
      type: object
      properties:
        url:
          type: string
          description: Original source URL
        download_url:
          type: string
          description: Direct download URL (S3 or blob storage)
          nullable: true

    ArtifactQuery:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
          enum: [model, dataset, code]

    ModelRating:
      type: object
      properties:
        name:
          type: string
        category:
          type: string
        net_score:
          type: number
          format: float
        net_score_latency:
          type: number
          format: float
        ramp_up_time:
          type: number
          format: float
        ramp_up_time_latency:
          type: number
          format: float
        bus_factor:
          type: number
          format: float
        bus_factor_latency:
          type: number
          format: float
        performance_claims:
          type: number
          format: float
        performance_claims_latency:
          type: number
          format: float
        license:
          type: number
          format: float
        license_latency:
          type: number
          format: float
        dataset_and_code_score:
          type: number
          format: float
        dataset_and_code_score_latency:
          type: number
          format: float
        dataset_quality:
          type: number
          format: float
        dataset_quality_latency:
          type: number
          format: float
        code_quality:
          type: number
          format: float
        code_quality_latency:
          type: number
          format: float
        reproducibility:
          type: number
          format: float
        reproducibility_latency:
          type: number
          format: float
        reviewedness:
          type: number
          format: float
        reviewedness_latency:
          type: number
          format: float
        tree_score:
          type: number
          format: float
        tree_score_latency:
          type: number
          format: float
        size_score:
          type: object
          description: Size score across different platforms
          properties:
            raspberry_pi:
              type: number
              format: float
            jetson_nano:
              type: number
              format: float
            desktop_pc:
              type: number
              format: float
            aws_server:
              type: number
              format: float
        size_score_latency:
          type: number
          format: float

    ArtifactCost:
      type: object
      additionalProperties:
        type: object
        properties:
          totalCost:
            type: number
          standaloneCost:
            type: number

    ActivityLog:
      type: object
      properties:
        id:
          type: integer
        user:
          type: string
        action:
          type: string
          enum: [upload, download, search, rate, delete]
        artifact_type:
          type: string
          enum: [model, dataset, code]
          nullable: true
        artifact_id:
          type: integer
          nullable: true
        artifact_name:
          type: string
          nullable: true
        details:
          type: string
          nullable: true
        ip_address:
          type: string
          nullable: true
        timestamp:
          type: string
          format: date-time